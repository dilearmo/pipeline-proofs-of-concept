{"source":2,"revision":27,"description":null,"createdBy":{"displayName":"ARIAS MORA DIEGO LEONARDO","url":"http://pachuca:8080/tfs/BCCR/_apis/Identities/68b9e3aa-d80a-4a89-a978-f9fd63462745","_links":{"avatar":{"href":"http://pachuca:8080/tfs/BCCR/_apis/GraphProfile/MemberAvatars/win.Uy0xLTUtMjEtMjk1NDUxMjI3LTE0MzYyMjY3NTctMTg0OTk3NzMxOC01NzQyMQ"}},"id":"68b9e3aa-d80a-4a89-a978-f9fd63462745","uniqueName":"PDC-ATLANTIDA\\ARIASMD","imageUrl":"http://pachuca:8080/tfs/BCCR/_apis/GraphProfile/MemberAvatars/win.Uy0xLTUtMjEtMjk1NDUxMjI3LTE0MzYyMjY3NTctMTg0OTk3NzMxOC01NzQyMQ","descriptor":"win.Uy0xLTUtMjEtMjk1NDUxMjI3LTE0MzYyMjY3NTctMTg0OTk3NzMxOC01NzQyMQ"},"createdOn":"2020-07-08T16:08:23.893Z","modifiedBy":{"displayName":"ARIAS MORA DIEGO LEONARDO","url":"http://pachuca:8080/tfs/BCCR/_apis/Identities/68b9e3aa-d80a-4a89-a978-f9fd63462745","_links":{"avatar":{"href":"http://pachuca:8080/tfs/BCCR/_apis/GraphProfile/MemberAvatars/win.Uy0xLTUtMjEtMjk1NDUxMjI3LTE0MzYyMjY3NTctMTg0OTk3NzMxOC01NzQyMQ"}},"id":"68b9e3aa-d80a-4a89-a978-f9fd63462745","uniqueName":"PDC-ATLANTIDA\\ARIASMD","imageUrl":"http://pachuca:8080/tfs/BCCR/_apis/GraphProfile/MemberAvatars/win.Uy0xLTUtMjEtMjk1NDUxMjI3LTE0MzYyMjY3NTctMTg0OTk3NzMxOC01NzQyMQ","descriptor":"win.Uy0xLTUtMjEtMjk1NDUxMjI3LTE0MzYyMjY3NTctMTg0OTk3NzMxOC01NzQyMQ"},"modifiedOn":"2020-07-15T16:08:02.380Z","isDeleted":false,"variables":{},"variableGroups":[],"environments":[{"id":6,"name":"Integración","rank":1,"owner":{"displayName":"ARIAS MORA DIEGO LEONARDO","url":"http://pachuca:8080/tfs/BCCR/_apis/Identities/68b9e3aa-d80a-4a89-a978-f9fd63462745","_links":{"avatar":{"href":"http://pachuca:8080/tfs/BCCR/_apis/GraphProfile/MemberAvatars/win.Uy0xLTUtMjEtMjk1NDUxMjI3LTE0MzYyMjY3NTctMTg0OTk3NzMxOC01NzQyMQ"}},"id":"68b9e3aa-d80a-4a89-a978-f9fd63462745","uniqueName":"PDC-ATLANTIDA\\ARIASMD","imageUrl":"http://pachuca:8080/tfs/BCCR/_apis/GraphProfile/MemberAvatars/win.Uy0xLTUtMjEtMjk1NDUxMjI3LTE0MzYyMjY3NTctMTg0OTk3NzMxOC01NzQyMQ","descriptor":"win.Uy0xLTUtMjEtMjk1NDUxMjI3LTE0MzYyMjY3NTctMTg0OTk3NzMxOC01NzQyMQ"},"variables":{"CodigoDeRespuestaDelServicio":{"value":"","allowOverride":true},"CodigosValidosDeDisponibilidad":{"value":"\"200\", \"401\", \"403\""},"ElServicioEstaDisponible":{"value":"","allowOverride":true},"UrlDelServicioDeDisponilidad":{"value":"https://servicios-rest-integracion-middle.pruebas.local/DevOps/Base/api/albums"}},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":16}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":17},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":18}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":null,"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":514,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Desplegar","refName":null,"workflowTasks":[{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Supuesto despliegue","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"script":"echo Aquí hay muchos pasos que permiten desplegar una aplicación","workingDirectory":"","failOnStderr":"false"}}]},{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":null,"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[{"alias":"_Bccr.Diss.Devops.Base.Ariasmd","artifactType":"Build","artifactDownloadMode":"All","artifactItems":[]}]},"queueId":514,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":2,"phaseType":1,"name":"Pruebas post-despliegue","refName":null,"workflowTasks":[{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Validar disponibilidad","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"# Se ejecuta el llamado al servicio y se obtiene solamente el StatusCode\n#$responseCode=Invoke-WebRequest -Uri $(UrlDelServicioDeDisponilidad) -UseBasicParsing | Select-Object -Expand StatusCode\n$responseCode=500#Está quemado, ya que la prueba fue en Lares y Lares no tiene acceso a internet\n\n#Se asigna el StatusCode obtenido a una variable del pipeline, para usarla en tareas posteriores, de ser necesario\nWrite-Host \"##vso[task.setvariable variable=CodigoDeRespuestaDelServicio]$responseCode\"\n\n#Se valida si el código recibido se encuentra dentro de la colección definida de códigos válidos para validar disponibilidad\n# En caso de no encontrar el código en la colección, se lanza un error\nif($(CodigosValidosDeDisponibilidad) -contains $responseCode) {\n    Write-Host \"##vso[task.setvariable variable=ElServicioEstaDisponible]true\"\n    Write-Host \"El servicio está disponible. Código de respuesta: $responseCode\"\n} else {\n    Write-Host \"##vso[task.setvariable variable=ElServicioEstaDisponible]false\"\n    throw \"El servicio no está disponible. Código de respuesta: $responseCode\"\n}","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""}},{"environment":{},"taskId":"d9bafed4-0b18-4f58-968d-86655b4d2ce9","version":"2.*","name":"Command Line Script","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables['ElServicioEstaDisponible'], 'true'))","inputs":{"script":"echo \"Servicio disponible. Respuesta del servicio código: $(CodigoRespuestaDisponibilidad)\"","workingDirectory":"","failOnStderr":"false"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":73,"url":"http://pachuca:8080/tfs/BCCR/8ae5c7d0-a8ee-40f2-8326-ac1f35c01288/_apis/Release/releases/73","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"http://pachuca:8080/tfs/BCCR/_apis/public/Release/badge/8ae5c7d0-a8ee-40f2-8326-ac1f35c01288/5/6"}],"artifacts":[{"sourceId":"8ae5c7d0-a8ee-40f2-8326-ac1f35c01288:181","type":"Build","alias":"_Bccr.Diss.Devops.Base.Ariasmd","definitionReference":{"artifactSourceDefinitionUrl":{"id":"http://pachuca:8080/tfs/_permalink/_build/index?collectionId=2730b4e4-0564-4cc8-bbeb-cf26f1f85973&projectId=8ae5c7d0-a8ee-40f2-8326-ac1f35c01288&definitionId=181","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"181","name":"Bccr.Diss.Devops.Base.Ariasmd"},"definitions":{"id":"","name":""},"IsMultiDefinitionType":{"id":"False","name":"False"},"project":{"id":"8ae5c7d0-a8ee-40f2-8326-ac1f35c01288","name":"DevOps-DISS"},"repository":{"id":"","name":""}},"isPrimary":true,"isRetained":false}],"triggers":[],"releaseNameFormat":"Release-$(rev:r)","tags":[],"pipelineProcess":{"type":1},"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseNew"},"System.EnvironmentRankLogicVersion":{"$type":"System.String","$value":"2"}},"id":5,"name":"PoC - Disponibilidad post despliegue","path":"\\","projectReference":null,"url":"http://pachuca:8080/tfs/BCCR/8ae5c7d0-a8ee-40f2-8326-ac1f35c01288/_apis/Release/definitions/5","_links":{"self":{"href":"http://pachuca:8080/tfs/BCCR/8ae5c7d0-a8ee-40f2-8326-ac1f35c01288/_apis/Release/definitions/5"},"web":{"href":"http://pachuca:8080/tfs/BCCR/8ae5c7d0-a8ee-40f2-8326-ac1f35c01288/_release?definitionId=5"}}}